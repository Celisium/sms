.include "macros.inc"

.section .text, "ax"  # 0x80005600 - 0x8036FBA0
.global OSRegisterResetFunction
OSRegisterResetFunction:
/* 80091620 0008E560  80 AD 93 48 */	lwz r5, ResetFunctionQueue-_SDA_BASE_(r13)
/* 80091624 0008E564  48 00 00 08 */	b lbl_8009162C
lbl_80091628:
/* 80091628 0008E568  80 A5 00 08 */	lwz r5, 8(r5)
lbl_8009162C:
/* 8009162C 0008E56C  28 05 00 00 */	cmplwi r5, 0
/* 80091630 0008E570  41 82 00 14 */	beq lbl_80091644
/* 80091634 0008E574  80 85 00 04 */	lwz r4, 4(r5)
/* 80091638 0008E578  80 03 00 04 */	lwz r0, 4(r3)
/* 8009163C 0008E57C  7C 04 00 40 */	cmplw r4, r0
/* 80091640 0008E580  40 81 FF E8 */	ble lbl_80091628
lbl_80091644:
/* 80091644 0008E584  28 05 00 00 */	cmplwi r5, 0
/* 80091648 0008E588  40 82 00 34 */	bne lbl_8009167C
/* 8009164C 0008E58C  38 AD 93 48 */	addi r5, r13, ResetFunctionQueue-_SDA_BASE_
/* 80091650 0008E590  84 85 00 04 */	lwzu r4, 4(r5)
/* 80091654 0008E594  28 04 00 00 */	cmplwi r4, 0
/* 80091658 0008E598  40 82 00 0C */	bne lbl_80091664
/* 8009165C 0008E59C  90 6D 93 48 */	stw r3, ResetFunctionQueue-_SDA_BASE_(r13)
/* 80091660 0008E5A0  48 00 00 08 */	b lbl_80091668
lbl_80091664:
/* 80091664 0008E5A4  90 64 00 08 */	stw r3, 8(r4)
lbl_80091668:
/* 80091668 0008E5A8  90 83 00 0C */	stw r4, 0xc(r3)
/* 8009166C 0008E5AC  38 00 00 00 */	li r0, 0
/* 80091670 0008E5B0  90 03 00 08 */	stw r0, 8(r3)
/* 80091674 0008E5B4  90 65 00 00 */	stw r3, 0(r5)
/* 80091678 0008E5B8  4E 80 00 20 */	blr 
lbl_8009167C:
/* 8009167C 0008E5BC  90 A3 00 08 */	stw r5, 8(r3)
/* 80091680 0008E5C0  80 85 00 0C */	lwz r4, 0xc(r5)
/* 80091684 0008E5C4  90 65 00 0C */	stw r3, 0xc(r5)
/* 80091688 0008E5C8  28 04 00 00 */	cmplwi r4, 0
/* 8009168C 0008E5CC  90 83 00 0C */	stw r4, 0xc(r3)
/* 80091690 0008E5D0  40 82 00 0C */	bne lbl_8009169C
/* 80091694 0008E5D4  90 6D 93 48 */	stw r3, ResetFunctionQueue-_SDA_BASE_(r13)
/* 80091698 0008E5D8  4E 80 00 20 */	blr 
lbl_8009169C:
/* 8009169C 0008E5DC  90 64 00 08 */	stw r3, 8(r4)
/* 800916A0 0008E5E0  4E 80 00 20 */	blr 

.global Reset
Reset:
/* 800916A4 0008E5E4  48 00 00 20 */	b lbl_800916C4
lbl_800916A8:
/* 800916A8 0008E5E8  7D 10 FA A6 */	mfspr r8, 0x3f0
/* 800916AC 0008E5EC  61 08 00 08 */	ori r8, r8, 8
/* 800916B0 0008E5F0  7D 10 FB A6 */	mtspr 0x3f0, r8
/* 800916B4 0008E5F4  4C 00 01 2C */	isync 
/* 800916B8 0008E5F8  7C 00 04 AC */	sync 0
/* 800916BC 0008E5FC  60 00 00 00 */	nop 
/* 800916C0 0008E600  48 00 00 08 */	b lbl_800916C8
lbl_800916C4:
/* 800916C4 0008E604  48 00 00 20 */	b lbl_800916E4
lbl_800916C8:
/* 800916C8 0008E608  7C AC 42 E6 */	mftb r5, 0x10c
lbl_800916CC:
/* 800916CC 0008E60C  7C CC 42 E6 */	mftb r6, 0x10c
/* 800916D0 0008E610  7C E5 30 50 */	subf r7, r5, r6
/* 800916D4 0008E614  28 07 11 24 */	cmplwi r7, 0x1124
/* 800916D8 0008E618  41 80 FF F4 */	blt lbl_800916CC
/* 800916DC 0008E61C  60 00 00 00 */	nop 
/* 800916E0 0008E620  48 00 00 08 */	b lbl_800916E8
lbl_800916E4:
/* 800916E4 0008E624  48 00 00 20 */	b lbl_80091704
lbl_800916E8:
/* 800916E8 0008E628  3D 00 CC 00 */	lis r8, 0xCC003000@h
/* 800916EC 0008E62C  61 08 30 00 */	ori r8, r8, 0xCC003000@l
/* 800916F0 0008E630  38 80 00 03 */	li r4, 3
/* 800916F4 0008E634  90 88 00 24 */	stw r4, 0x24(r8)
/* 800916F8 0008E638  90 68 00 24 */	stw r3, 0x24(r8)
/* 800916FC 0008E63C  60 00 00 00 */	nop 
/* 80091700 0008E640  48 00 00 08 */	b lbl_80091708
lbl_80091704:
/* 80091704 0008E644  48 00 00 0C */	b lbl_80091710
lbl_80091708:
/* 80091708 0008E648  60 00 00 00 */	nop 
/* 8009170C 0008E64C  4B FF FF FC */	b lbl_80091708
lbl_80091710:
/* 80091710 0008E650  4B FF FF 98 */	b lbl_800916A8

.global __OSDoHotReset
__OSDoHotReset:
/* 80091714 0008E654  7C 08 02 A6 */	mflr r0
/* 80091718 0008E658  90 01 00 04 */	stw r0, 4(r1)
/* 8009171C 0008E65C  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 80091720 0008E660  93 E1 00 14 */	stw r31, 0x14(r1)
/* 80091724 0008E664  7C 7F 1B 78 */	mr r31, r3
/* 80091728 0008E668  4B FF EA A5 */	bl OSDisableInterrupts
/* 8009172C 0008E66C  3C 60 CC 00 */	lis r3, 0xCC002000@ha
/* 80091730 0008E670  38 63 20 00 */	addi r3, r3, 0xCC002000@l
/* 80091734 0008E674  38 00 00 00 */	li r0, 0
/* 80091738 0008E678  B0 03 00 02 */	sth r0, 2(r3)
/* 8009173C 0008E67C  4B FF C9 71 */	bl ICFlashInvalidate
/* 80091740 0008E680  57 E3 18 38 */	slwi r3, r31, 3
/* 80091744 0008E684  4B FF FF 61 */	bl Reset
/* 80091748 0008E688  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 8009174C 0008E68C  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 80091750 0008E690  38 21 00 18 */	addi r1, r1, 0x18
/* 80091754 0008E694  7C 08 03 A6 */	mtlr r0
/* 80091758 0008E698  4E 80 00 20 */	blr 

.global OSResetSystem
OSResetSystem:
/* 8009175C 0008E69C  7C 08 02 A6 */	mflr r0
/* 80091760 0008E6A0  90 01 00 04 */	stw r0, 4(r1)
/* 80091764 0008E6A4  94 21 FF C0 */	stwu r1, -0x40(r1)
/* 80091768 0008E6A8  BF 41 00 28 */	stmw r26, 0x28(r1)
/* 8009176C 0008E6AC  7C 7A 1B 78 */	mr r26, r3
/* 80091770 0008E6B0  7C 9D 23 78 */	mr r29, r4
/* 80091774 0008E6B4  7C BE 2B 78 */	mr r30, r5
/* 80091778 0008E6B8  48 00 15 51 */	bl OSDisableScheduler
/* 8009177C 0008E6BC  4B FF C7 15 */	bl __OSStopAudioSystem
/* 80091780 0008E6C0  2C 1A 00 02 */	cmpwi r26, 2
/* 80091784 0008E6C4  40 82 00 10 */	bne lbl_80091794
/* 80091788 0008E6C8  38 60 00 01 */	li r3, 1
/* 8009178C 0008E6CC  48 00 B5 E1 */	bl __PADDisableRecalibration
/* 80091790 0008E6D0  7C 7F 1B 78 */	mr r31, r3
lbl_80091794:
/* 80091794 0008E6D4  48 00 00 04 */	b lbl_80091798
lbl_80091798:
/* 80091798 0008E6D8  48 00 00 04 */	b lbl_8009179C
lbl_8009179C:
/* 8009179C 0008E6DC  83 6D 93 48 */	lwz r27, ResetFunctionQueue-_SDA_BASE_(r13)
/* 800917A0 0008E6E0  3B 80 00 00 */	li r28, 0
/* 800917A4 0008E6E4  48 00 00 04 */	b lbl_800917A8
lbl_800917A8:
/* 800917A8 0008E6E8  48 00 00 04 */	b lbl_800917AC
lbl_800917AC:
/* 800917AC 0008E6EC  48 00 00 24 */	b lbl_800917D0
lbl_800917B0:
/* 800917B0 0008E6F0  38 60 00 00 */	li r3, 0
/* 800917B4 0008E6F4  81 9B 00 00 */	lwz r12, 0(r27)
/* 800917B8 0008E6F8  7D 88 03 A6 */	mtlr r12
/* 800917BC 0008E6FC  4E 80 00 21 */	blrl 
/* 800917C0 0008E700  7C 60 00 34 */	cntlzw r0, r3
/* 800917C4 0008E704  83 7B 00 08 */	lwz r27, 8(r27)
/* 800917C8 0008E708  54 00 D9 7E */	srwi r0, r0, 5
/* 800917CC 0008E70C  7F 9C 03 78 */	or r28, r28, r0
lbl_800917D0:
/* 800917D0 0008E710  28 1B 00 00 */	cmplwi r27, 0
/* 800917D4 0008E714  40 82 FF DC */	bne lbl_800917B0
/* 800917D8 0008E718  48 00 0C 8D */	bl __OSSyncSram
/* 800917DC 0008E71C  7C 60 00 34 */	cntlzw r0, r3
/* 800917E0 0008E720  54 00 D9 7E */	srwi r0, r0, 5
/* 800917E4 0008E724  7F 9C 03 78 */	or r28, r28, r0
/* 800917E8 0008E728  2C 1C 00 00 */	cmpwi r28, 0
/* 800917EC 0008E72C  41 82 00 0C */	beq lbl_800917F8
/* 800917F0 0008E730  38 00 00 00 */	li r0, 0
/* 800917F4 0008E734  48 00 00 08 */	b lbl_800917FC
lbl_800917F8:
/* 800917F8 0008E738  38 00 00 01 */	li r0, 1
lbl_800917FC:
/* 800917FC 0008E73C  2C 00 00 00 */	cmpwi r0, 0
/* 80091800 0008E740  41 82 FF 9C */	beq lbl_8009179C
/* 80091804 0008E744  2C 1A 00 01 */	cmpwi r26, 1
/* 80091808 0008E748  40 82 00 38 */	bne lbl_80091840
/* 8009180C 0008E74C  2C 1E 00 00 */	cmpwi r30, 0
/* 80091810 0008E750  41 82 00 30 */	beq lbl_80091840
/* 80091814 0008E754  48 00 08 49 */	bl __OSLockSram
/* 80091818 0008E758  88 03 00 13 */	lbz r0, 0x13(r3)
/* 8009181C 0008E75C  60 00 00 40 */	ori r0, r0, 0x40
/* 80091820 0008E760  98 03 00 13 */	stb r0, 0x13(r3)
/* 80091824 0008E764  38 60 00 01 */	li r3, 1
/* 80091828 0008E768  48 00 0B F5 */	bl __OSUnlockSram
/* 8009182C 0008E76C  48 00 00 04 */	b lbl_80091830
lbl_80091830:
/* 80091830 0008E770  48 00 00 04 */	b lbl_80091834
lbl_80091834:
/* 80091834 0008E774  48 00 0C 31 */	bl __OSSyncSram
/* 80091838 0008E778  2C 03 00 00 */	cmpwi r3, 0
/* 8009183C 0008E77C  41 82 FF F8 */	beq lbl_80091834
lbl_80091840:
/* 80091840 0008E780  4B FF E9 8D */	bl OSDisableInterrupts
/* 80091844 0008E784  83 8D 93 48 */	lwz r28, ResetFunctionQueue-_SDA_BASE_(r13)
/* 80091848 0008E788  3B 60 00 00 */	li r27, 0
/* 8009184C 0008E78C  48 00 00 04 */	b lbl_80091850
lbl_80091850:
/* 80091850 0008E790  48 00 00 04 */	b lbl_80091854
lbl_80091854:
/* 80091854 0008E794  48 00 00 24 */	b lbl_80091878
lbl_80091858:
/* 80091858 0008E798  38 60 00 01 */	li r3, 1
/* 8009185C 0008E79C  81 9C 00 00 */	lwz r12, 0(r28)
/* 80091860 0008E7A0  7D 88 03 A6 */	mtlr r12
/* 80091864 0008E7A4  4E 80 00 21 */	blrl 
/* 80091868 0008E7A8  7C 60 00 34 */	cntlzw r0, r3
/* 8009186C 0008E7AC  83 9C 00 08 */	lwz r28, 8(r28)
/* 80091870 0008E7B0  54 00 D9 7E */	srwi r0, r0, 5
/* 80091874 0008E7B4  7F 7B 03 78 */	or r27, r27, r0
lbl_80091878:
/* 80091878 0008E7B8  28 1C 00 00 */	cmplwi r28, 0
/* 8009187C 0008E7BC  40 82 FF DC */	bne lbl_80091858
/* 80091880 0008E7C0  48 00 0B E5 */	bl __OSSyncSram
/* 80091884 0008E7C4  4B FF C9 51 */	bl LCDisable
/* 80091888 0008E7C8  2C 1A 00 01 */	cmpwi r26, 1
/* 8009188C 0008E7CC  40 82 00 28 */	bne lbl_800918B4
/* 80091890 0008E7D0  4B FF E9 3D */	bl OSDisableInterrupts
/* 80091894 0008E7D4  3C 60 CC 00 */	lis r3, 0xCC002000@ha
/* 80091898 0008E7D8  38 63 20 00 */	addi r3, r3, 0xCC002000@l
/* 8009189C 0008E7DC  38 00 00 00 */	li r0, 0
/* 800918A0 0008E7E0  B0 03 00 02 */	sth r0, 2(r3)
/* 800918A4 0008E7E4  4B FF C8 09 */	bl ICFlashInvalidate
/* 800918A8 0008E7E8  57 A3 18 38 */	slwi r3, r29, 3
/* 800918AC 0008E7EC  4B FF FD F9 */	bl Reset
/* 800918B0 0008E7F0  48 00 00 60 */	b lbl_80091910
lbl_800918B4:
/* 800918B4 0008E7F4  2C 1A 00 00 */	cmpwi r26, 0
/* 800918B8 0008E7F8  40 82 00 58 */	bne lbl_80091910
/* 800918BC 0008E7FC  3C 60 80 00 */	lis r3, 0x800000DC@ha
/* 800918C0 0008E800  80 63 00 DC */	lwz r3, 0x800000DC@l(r3)
/* 800918C4 0008E804  48 00 00 04 */	b lbl_800918C8
lbl_800918C8:
/* 800918C8 0008E808  48 00 00 04 */	b lbl_800918CC
lbl_800918CC:
/* 800918CC 0008E80C  48 00 00 2C */	b lbl_800918F8
lbl_800918D0:
/* 800918D0 0008E810  A0 03 02 C8 */	lhz r0, 0x2c8(r3)
/* 800918D4 0008E814  83 63 02 FC */	lwz r27, 0x2fc(r3)
/* 800918D8 0008E818  2C 00 00 04 */	cmpwi r0, 4
/* 800918DC 0008E81C  41 82 00 14 */	beq lbl_800918F0
/* 800918E0 0008E820  40 80 00 14 */	bge lbl_800918F4
/* 800918E4 0008E824  2C 00 00 01 */	cmpwi r0, 1
/* 800918E8 0008E828  41 82 00 08 */	beq lbl_800918F0
/* 800918EC 0008E82C  48 00 00 08 */	b lbl_800918F4
lbl_800918F0:
/* 800918F0 0008E830  48 00 1B 7D */	bl OSCancelThread
lbl_800918F4:
/* 800918F4 0008E834  7F 63 DB 78 */	mr r3, r27
lbl_800918F8:
/* 800918F8 0008E838  28 03 00 00 */	cmplwi r3, 0
/* 800918FC 0008E83C  40 82 FF D4 */	bne lbl_800918D0
/* 80091900 0008E840  48 00 14 09 */	bl OSEnableScheduler
/* 80091904 0008E844  7F A3 EB 78 */	mr r3, r29
/* 80091908 0008E848  7F C4 F3 78 */	mr r4, r30
/* 8009190C 0008E84C  4B FF FB 55 */	bl __OSReboot
lbl_80091910:
/* 80091910 0008E850  3C 60 80 00 */	lis r3, 0x800000DC@ha
/* 80091914 0008E854  80 63 00 DC */	lwz r3, 0x800000DC@l(r3)
/* 80091918 0008E858  48 00 00 04 */	b lbl_8009191C
lbl_8009191C:
/* 8009191C 0008E85C  48 00 00 04 */	b lbl_80091920
lbl_80091920:
/* 80091920 0008E860  48 00 00 2C */	b lbl_8009194C
lbl_80091924:
/* 80091924 0008E864  A0 03 02 C8 */	lhz r0, 0x2c8(r3)
/* 80091928 0008E868  83 63 02 FC */	lwz r27, 0x2fc(r3)
/* 8009192C 0008E86C  2C 00 00 04 */	cmpwi r0, 4
/* 80091930 0008E870  41 82 00 14 */	beq lbl_80091944
/* 80091934 0008E874  40 80 00 14 */	bge lbl_80091948
/* 80091938 0008E878  2C 00 00 01 */	cmpwi r0, 1
/* 8009193C 0008E87C  41 82 00 08 */	beq lbl_80091944
/* 80091940 0008E880  48 00 00 08 */	b lbl_80091948
lbl_80091944:
/* 80091944 0008E884  48 00 1B 29 */	bl OSCancelThread
lbl_80091948:
/* 80091948 0008E888  7F 63 DB 78 */	mr r3, r27
lbl_8009194C:
/* 8009194C 0008E88C  28 03 00 00 */	cmplwi r3, 0
/* 80091950 0008E890  40 82 FF D4 */	bne lbl_80091924
/* 80091954 0008E894  3F A0 80 00 */	lis r29, 0x80000040@ha
/* 80091958 0008E898  38 7D 00 40 */	addi r3, r29, 0x80000040@l
/* 8009195C 0008E89C  38 80 00 00 */	li r4, 0
/* 80091960 0008E8A0  38 A0 00 8C */	li r5, 0x8c
/* 80091964 0008E8A4  4B F7 17 9D */	bl memset
/* 80091968 0008E8A8  38 7D 00 D4 */	addi r3, r29, 0xd4
/* 8009196C 0008E8AC  38 80 00 00 */	li r4, 0
/* 80091970 0008E8B0  38 A0 00 14 */	li r5, 0x14
/* 80091974 0008E8B4  4B F7 17 8D */	bl memset
/* 80091978 0008E8B8  38 7D 00 F4 */	addi r3, r29, 0xf4
/* 8009197C 0008E8BC  38 80 00 00 */	li r4, 0
/* 80091980 0008E8C0  38 A0 00 04 */	li r5, 4
/* 80091984 0008E8C4  4B F7 17 7D */	bl memset
/* 80091988 0008E8C8  38 7D 30 00 */	addi r3, r29, 0x3000
/* 8009198C 0008E8CC  38 80 00 00 */	li r4, 0
/* 80091990 0008E8D0  38 A0 00 C0 */	li r5, 0xc0
/* 80091994 0008E8D4  4B F7 17 6D */	bl memset
/* 80091998 0008E8D8  38 7D 30 C8 */	addi r3, r29, 0x30c8
/* 8009199C 0008E8DC  38 80 00 00 */	li r4, 0
/* 800919A0 0008E8E0  38 A0 00 0C */	li r5, 0xc
/* 800919A4 0008E8E4  4B F7 17 5D */	bl memset
/* 800919A8 0008E8E8  38 7D 30 E2 */	addi r3, r29, 0x30e2
/* 800919AC 0008E8EC  38 80 00 00 */	li r4, 0
/* 800919B0 0008E8F0  38 A0 00 01 */	li r5, 1
/* 800919B4 0008E8F4  4B F7 17 4D */	bl memset
/* 800919B8 0008E8F8  7F E3 FB 78 */	mr r3, r31
/* 800919BC 0008E8FC  48 00 B3 B1 */	bl __PADDisableRecalibration
/* 800919C0 0008E900  BB 41 00 28 */	lmw r26, 0x28(r1)
/* 800919C4 0008E904  80 01 00 44 */	lwz r0, 0x44(r1)
/* 800919C8 0008E908  38 21 00 40 */	addi r1, r1, 0x40
/* 800919CC 0008E90C  7C 08 03 A6 */	mtlr r0
/* 800919D0 0008E910  4E 80 00 20 */	blr 

.global OSGetResetCode
OSGetResetCode:
/* 800919D4 0008E914  3C 60 80 00 */	lis r3, 0x800030E2@ha
/* 800919D8 0008E918  88 03 30 E2 */	lbz r0, 0x800030E2@l(r3)
/* 800919DC 0008E91C  28 00 00 00 */	cmplwi r0, 0
/* 800919E0 0008E920  41 82 00 0C */	beq lbl_800919EC
/* 800919E4 0008E924  3C 60 80 00 */	lis r3, 0x8000
/* 800919E8 0008E928  48 00 00 18 */	b lbl_80091A00
lbl_800919EC:
/* 800919EC 0008E92C  3C 60 CC 00 */	lis r3, 0xCC003000@ha
/* 800919F0 0008E930  38 63 30 00 */	addi r3, r3, 0xCC003000@l
/* 800919F4 0008E934  80 03 00 24 */	lwz r0, 0x24(r3)
/* 800919F8 0008E938  54 00 00 38 */	rlwinm r0, r0, 0, 0, 0x1c
/* 800919FC 0008E93C  54 03 E8 FE */	srwi r3, r0, 3
lbl_80091A00:
/* 80091A00 0008E940  4E 80 00 20 */	blr 

.section .sbss, "wa"  # 0x804097C0 - 0x8040B45C
.global ResetFunctionQueue
ResetFunctionQueue:
	.skip 0x8
