.include "macros.inc"

.section .text, "ax"  # 0x80005600 - 0x8036FBA0
.global __CARDGetDirBlock
__CARDGetDirBlock:
/* 800A1730 0009E670  80 63 00 84 */	lwz r3, 0x84(r3)
/* 800A1734 0009E674  4E 80 00 20 */	blr 

WriteCallback:
/* 800A1738 0009E678  7C 08 02 A6 */	mflr r0
/* 800A173C 0009E67C  90 01 00 04 */	stw r0, 4(r1)
/* 800A1740 0009E680  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800A1744 0009E684  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800A1748 0009E688  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800A174C 0009E68C  7C 9E 23 79 */	or. r30, r4, r4
/* 800A1750 0009E690  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800A1754 0009E694  3B A3 00 00 */	addi r29, r3, 0
/* 800A1758 0009E698  1C BD 01 10 */	mulli r5, r29, 0x110
/* 800A175C 0009E69C  3C 60 80 3F */	lis r3, __CARDBlock@ha
/* 800A1760 0009E6A0  38 03 BF 60 */	addi r0, r3, __CARDBlock@l
/* 800A1764 0009E6A4  7F E0 2A 14 */	add r31, r0, r5
/* 800A1768 0009E6A8  41 80 00 44 */	blt lbl_800A17AC
/* 800A176C 0009E6AC  80 7F 00 80 */	lwz r3, 0x80(r31)
/* 800A1770 0009E6B0  80 1F 00 84 */	lwz r0, 0x84(r31)
/* 800A1774 0009E6B4  38 83 20 00 */	addi r4, r3, 0x2000
/* 800A1778 0009E6B8  7C 00 20 40 */	cmplw r0, r4
/* 800A177C 0009E6BC  38 03 40 00 */	addi r0, r3, 0x4000
/* 800A1780 0009E6C0  40 82 00 18 */	bne lbl_800A1798
/* 800A1784 0009E6C4  90 1F 00 84 */	stw r0, 0x84(r31)
/* 800A1788 0009E6C8  7C 03 03 78 */	mr r3, r0
/* 800A178C 0009E6CC  38 A0 20 00 */	li r5, 0x2000
/* 800A1790 0009E6D0  4B F6 1A 65 */	bl memcpy
/* 800A1794 0009E6D4  48 00 00 18 */	b lbl_800A17AC
lbl_800A1798:
/* 800A1798 0009E6D8  90 9F 00 84 */	stw r4, 0x84(r31)
/* 800A179C 0009E6DC  38 64 00 00 */	addi r3, r4, 0
/* 800A17A0 0009E6E0  7C 04 03 78 */	mr r4, r0
/* 800A17A4 0009E6E4  38 A0 20 00 */	li r5, 0x2000
/* 800A17A8 0009E6E8  4B F6 1A 4D */	bl memcpy
lbl_800A17AC:
/* 800A17AC 0009E6EC  80 1F 00 D0 */	lwz r0, 0xd0(r31)
/* 800A17B0 0009E6F0  28 00 00 00 */	cmplwi r0, 0
/* 800A17B4 0009E6F4  40 82 00 10 */	bne lbl_800A17C4
/* 800A17B8 0009E6F8  38 7F 00 00 */	addi r3, r31, 0
/* 800A17BC 0009E6FC  38 9E 00 00 */	addi r4, r30, 0
/* 800A17C0 0009E700  4B FF E4 8D */	bl __CARDPutControlBlock
lbl_800A17C4:
/* 800A17C4 0009E704  80 1F 00 D8 */	lwz r0, 0xd8(r31)
/* 800A17C8 0009E708  28 00 00 00 */	cmplwi r0, 0
/* 800A17CC 0009E70C  7C 0C 03 78 */	mr r12, r0
/* 800A17D0 0009E710  41 82 00 1C */	beq lbl_800A17EC
/* 800A17D4 0009E714  38 00 00 00 */	li r0, 0
/* 800A17D8 0009E718  7D 88 03 A6 */	mtlr r12
/* 800A17DC 0009E71C  90 1F 00 D8 */	stw r0, 0xd8(r31)
/* 800A17E0 0009E720  38 7D 00 00 */	addi r3, r29, 0
/* 800A17E4 0009E724  38 9E 00 00 */	addi r4, r30, 0
/* 800A17E8 0009E728  4E 80 00 21 */	blrl 
lbl_800A17EC:
/* 800A17EC 0009E72C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800A17F0 0009E730  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800A17F4 0009E734  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800A17F8 0009E738  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800A17FC 0009E73C  38 21 00 20 */	addi r1, r1, 0x20
/* 800A1800 0009E740  7C 08 03 A6 */	mtlr r0
/* 800A1804 0009E744  4E 80 00 20 */	blr 

EraseCallback:
/* 800A1808 0009E748  7C 08 02 A6 */	mflr r0
/* 800A180C 0009E74C  90 01 00 04 */	stw r0, 4(r1)
/* 800A1810 0009E750  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 800A1814 0009E754  93 E1 00 24 */	stw r31, 0x24(r1)
/* 800A1818 0009E758  3B E3 00 00 */	addi r31, r3, 0
/* 800A181C 0009E75C  3C 60 80 3F */	lis r3, __CARDBlock@ha
/* 800A1820 0009E760  93 C1 00 20 */	stw r30, 0x20(r1)
/* 800A1824 0009E764  1C BF 01 10 */	mulli r5, r31, 0x110
/* 800A1828 0009E768  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 800A182C 0009E76C  38 03 BF 60 */	addi r0, r3, __CARDBlock@l
/* 800A1830 0009E770  7C 9D 23 79 */	or. r29, r4, r4
/* 800A1834 0009E774  7F C0 2A 14 */	add r30, r0, r5
/* 800A1838 0009E778  41 80 00 3C */	blt lbl_800A1874
/* 800A183C 0009E77C  80 BE 00 84 */	lwz r5, 0x84(r30)
/* 800A1840 0009E780  3C 60 80 0A */	lis r3, WriteCallback@ha
/* 800A1844 0009E784  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 800A1848 0009E788  38 E3 17 38 */	addi r7, r3, WriteCallback@l
/* 800A184C 0009E78C  80 7E 00 0C */	lwz r3, 0xc(r30)
/* 800A1850 0009E790  7C 00 28 50 */	subf r0, r0, r5
/* 800A1854 0009E794  54 00 9B 7E */	srwi r0, r0, 0xd
/* 800A1858 0009E798  7C 83 01 D6 */	mullw r4, r3, r0
/* 800A185C 0009E79C  38 C5 00 00 */	addi r6, r5, 0
/* 800A1860 0009E7A0  38 7F 00 00 */	addi r3, r31, 0
/* 800A1864 0009E7A4  38 A0 20 00 */	li r5, 0x2000
/* 800A1868 0009E7A8  4B FF FA FD */	bl __CARDWrite
/* 800A186C 0009E7AC  7C 7D 1B 79 */	or. r29, r3, r3
/* 800A1870 0009E7B0  40 80 00 44 */	bge lbl_800A18B4
lbl_800A1874:
/* 800A1874 0009E7B4  80 1E 00 D0 */	lwz r0, 0xd0(r30)
/* 800A1878 0009E7B8  28 00 00 00 */	cmplwi r0, 0
/* 800A187C 0009E7BC  40 82 00 10 */	bne lbl_800A188C
/* 800A1880 0009E7C0  38 7E 00 00 */	addi r3, r30, 0
/* 800A1884 0009E7C4  38 9D 00 00 */	addi r4, r29, 0
/* 800A1888 0009E7C8  4B FF E3 C5 */	bl __CARDPutControlBlock
lbl_800A188C:
/* 800A188C 0009E7CC  80 1E 00 D8 */	lwz r0, 0xd8(r30)
/* 800A1890 0009E7D0  28 00 00 00 */	cmplwi r0, 0
/* 800A1894 0009E7D4  7C 0C 03 78 */	mr r12, r0
/* 800A1898 0009E7D8  41 82 00 1C */	beq lbl_800A18B4
/* 800A189C 0009E7DC  38 00 00 00 */	li r0, 0
/* 800A18A0 0009E7E0  7D 88 03 A6 */	mtlr r12
/* 800A18A4 0009E7E4  90 1E 00 D8 */	stw r0, 0xd8(r30)
/* 800A18A8 0009E7E8  38 7F 00 00 */	addi r3, r31, 0
/* 800A18AC 0009E7EC  38 9D 00 00 */	addi r4, r29, 0
/* 800A18B0 0009E7F0  4E 80 00 21 */	blrl 
lbl_800A18B4:
/* 800A18B4 0009E7F4  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 800A18B8 0009E7F8  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 800A18BC 0009E7FC  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 800A18C0 0009E800  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 800A18C4 0009E804  38 21 00 28 */	addi r1, r1, 0x28
/* 800A18C8 0009E808  7C 08 03 A6 */	mtlr r0
/* 800A18CC 0009E80C  4E 80 00 20 */	blr 

.global __CARDUpdateDir
__CARDUpdateDir:
/* 800A18D0 0009E810  7C 08 02 A6 */	mflr r0
/* 800A18D4 0009E814  90 01 00 04 */	stw r0, 4(r1)
/* 800A18D8 0009E818  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 800A18DC 0009E81C  93 E1 00 24 */	stw r31, 0x24(r1)
/* 800A18E0 0009E820  93 C1 00 20 */	stw r30, 0x20(r1)
/* 800A18E4 0009E824  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 800A18E8 0009E828  3B A4 00 00 */	addi r29, r4, 0
/* 800A18EC 0009E82C  93 81 00 18 */	stw r28, 0x18(r1)
/* 800A18F0 0009E830  3B 83 00 00 */	addi r28, r3, 0
/* 800A18F4 0009E834  1C BC 01 10 */	mulli r5, r28, 0x110
/* 800A18F8 0009E838  3C 60 80 3F */	lis r3, __CARDBlock@ha
/* 800A18FC 0009E83C  38 03 BF 60 */	addi r0, r3, __CARDBlock@l
/* 800A1900 0009E840  7F C0 2A 14 */	add r30, r0, r5
/* 800A1904 0009E844  80 1E 00 00 */	lwz r0, 0(r30)
/* 800A1908 0009E848  2C 00 00 00 */	cmpwi r0, 0
/* 800A190C 0009E84C  40 82 00 0C */	bne lbl_800A1918
/* 800A1910 0009E850  38 60 FF FD */	li r3, -3
/* 800A1914 0009E854  48 00 00 60 */	b lbl_800A1974
lbl_800A1918:
/* 800A1918 0009E858  83 FE 00 84 */	lwz r31, 0x84(r30)
/* 800A191C 0009E85C  38 80 1F FC */	li r4, 0x1ffc
/* 800A1920 0009E860  A8 BF 1F FA */	lha r5, 0x1ffa(r31)
/* 800A1924 0009E864  38 DF 1F C0 */	addi r6, r31, 0x1fc0
/* 800A1928 0009E868  38 7F 00 00 */	addi r3, r31, 0
/* 800A192C 0009E86C  38 05 00 01 */	addi r0, r5, 1
/* 800A1930 0009E870  B0 1F 1F FA */	sth r0, 0x1ffa(r31)
/* 800A1934 0009E874  38 A6 00 3C */	addi r5, r6, 0x3c
/* 800A1938 0009E878  38 C6 00 3E */	addi r6, r6, 0x3e
/* 800A193C 0009E87C  48 00 00 59 */	bl __CARDCheckSum
/* 800A1940 0009E880  38 7F 00 00 */	addi r3, r31, 0
/* 800A1944 0009E884  38 80 20 00 */	li r4, 0x2000
/* 800A1948 0009E888  4B FE C6 99 */	bl DCStoreRange
/* 800A194C 0009E88C  93 BE 00 D8 */	stw r29, 0xd8(r30)
/* 800A1950 0009E890  3C 60 80 0A */	lis r3, EraseCallback@ha
/* 800A1954 0009E894  38 A3 18 08 */	addi r5, r3, EraseCallback@l
/* 800A1958 0009E898  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 800A195C 0009E89C  7F 83 E3 78 */	mr r3, r28
/* 800A1960 0009E8A0  80 9E 00 0C */	lwz r4, 0xc(r30)
/* 800A1964 0009E8A4  7C 00 F8 50 */	subf r0, r0, r31
/* 800A1968 0009E8A8  54 00 9B 7E */	srwi r0, r0, 0xd
/* 800A196C 0009E8AC  7C 84 01 D6 */	mullw r4, r4, r0
/* 800A1970 0009E8B0  4B FF E0 71 */	bl __CARDEraseSector
lbl_800A1974:
/* 800A1974 0009E8B4  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 800A1978 0009E8B8  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 800A197C 0009E8BC  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 800A1980 0009E8C0  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 800A1984 0009E8C4  83 81 00 18 */	lwz r28, 0x18(r1)
/* 800A1988 0009E8C8  38 21 00 28 */	addi r1, r1, 0x28
/* 800A198C 0009E8CC  7C 08 03 A6 */	mtlr r0
/* 800A1990 0009E8D0  4E 80 00 20 */	blr 
