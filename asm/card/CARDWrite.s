.include "macros.inc"

.section .text, "ax"  # 0x80005600 - 0x8036FBA0
WriteCallback:
/* 800A4688 000A15C8  7C 08 02 A6 */	mflr r0
/* 800A468C 000A15CC  90 01 00 04 */	stw r0, 4(r1)
/* 800A4690 000A15D0  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800A4694 000A15D4  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800A4698 000A15D8  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800A469C 000A15DC  3B C3 00 00 */	addi r30, r3, 0
/* 800A46A0 000A15E0  3C 60 80 3F */	lis r3, __CARDBlock@ha
/* 800A46A4 000A15E4  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800A46A8 000A15E8  1C BE 01 10 */	mulli r5, r30, 0x110
/* 800A46AC 000A15EC  93 81 00 10 */	stw r28, 0x10(r1)
/* 800A46B0 000A15F0  38 03 BF 60 */	addi r0, r3, __CARDBlock@l
/* 800A46B4 000A15F4  7C 9C 23 79 */	or. r28, r4, r4
/* 800A46B8 000A15F8  7F E0 2A 14 */	add r31, r0, r5
/* 800A46BC 000A15FC  41 80 00 F0 */	blt lbl_800A47AC
/* 800A46C0 000A1600  83 BF 00 C0 */	lwz r29, 0xc0(r31)
/* 800A46C4 000A1604  80 7D 00 0C */	lwz r3, 0xc(r29)
/* 800A46C8 000A1608  2C 03 00 00 */	cmpwi r3, 0
/* 800A46CC 000A160C  40 80 00 0C */	bge lbl_800A46D8
/* 800A46D0 000A1610  3B 80 FF F2 */	li r28, -14
/* 800A46D4 000A1614  48 00 00 D8 */	b lbl_800A47AC
lbl_800A46D8:
/* 800A46D8 000A1618  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 800A46DC 000A161C  7C 00 18 50 */	subf r0, r0, r3
/* 800A46E0 000A1620  90 1D 00 0C */	stw r0, 0xc(r29)
/* 800A46E4 000A1624  80 1D 00 0C */	lwz r0, 0xc(r29)
/* 800A46E8 000A1628  2C 00 00 00 */	cmpwi r0, 0
/* 800A46EC 000A162C  41 81 00 54 */	bgt lbl_800A4740
/* 800A46F0 000A1630  7F E3 FB 78 */	mr r3, r31
/* 800A46F4 000A1634  4B FF D0 3D */	bl __CARDGetDirBlock
/* 800A46F8 000A1638  80 BD 00 04 */	lwz r5, 4(r29)
/* 800A46FC 000A163C  3C 80 80 00 */	lis r4, 0x800000F8@ha
/* 800A4700 000A1640  80 04 00 F8 */	lwz r0, 0x800000F8@l(r4)
/* 800A4704 000A1644  54 A4 30 32 */	slwi r4, r5, 6
/* 800A4708 000A1648  7F 83 22 14 */	add r28, r3, r4
/* 800A470C 000A164C  54 1D F0 BE */	srwi r29, r0, 2
/* 800A4710 000A1650  4B FE F6 E9 */	bl OSGetTime
/* 800A4714 000A1654  38 DD 00 00 */	addi r6, r29, 0
/* 800A4718 000A1658  38 A0 00 00 */	li r5, 0
/* 800A471C 000A165C  4B FD E5 E9 */	bl __div2i
/* 800A4720 000A1660  90 9C 00 28 */	stw r4, 0x28(r28)
/* 800A4724 000A1664  38 00 00 00 */	li r0, 0
/* 800A4728 000A1668  38 7E 00 00 */	addi r3, r30, 0
/* 800A472C 000A166C  80 9F 00 D0 */	lwz r4, 0xd0(r31)
/* 800A4730 000A1670  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 800A4734 000A1674  4B FF D1 9D */	bl __CARDUpdateDir
/* 800A4738 000A1678  7C 7C 1B 78 */	mr r28, r3
/* 800A473C 000A167C  48 00 00 68 */	b lbl_800A47A4
lbl_800A4740:
/* 800A4740 000A1680  7F E3 FB 78 */	mr r3, r31
/* 800A4744 000A1684  4B FF CC 85 */	bl __CARDGetFatBlock
/* 800A4748 000A1688  80 9D 00 08 */	lwz r4, 8(r29)
/* 800A474C 000A168C  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 800A4750 000A1690  7C 04 02 14 */	add r0, r4, r0
/* 800A4754 000A1694  90 1D 00 08 */	stw r0, 8(r29)
/* 800A4758 000A1698  A0 1D 00 10 */	lhz r0, 0x10(r29)
/* 800A475C 000A169C  54 00 08 3C */	slwi r0, r0, 1
/* 800A4760 000A16A0  7C 03 02 2E */	lhzx r0, r3, r0
/* 800A4764 000A16A4  B0 1D 00 10 */	sth r0, 0x10(r29)
/* 800A4768 000A16A8  A0 9D 00 10 */	lhz r4, 0x10(r29)
/* 800A476C 000A16AC  28 04 00 05 */	cmplwi r4, 5
/* 800A4770 000A16B0  41 80 00 10 */	blt lbl_800A4780
/* 800A4774 000A16B4  A0 1F 00 10 */	lhz r0, 0x10(r31)
/* 800A4778 000A16B8  7C 04 00 40 */	cmplw r4, r0
/* 800A477C 000A16BC  41 80 00 0C */	blt lbl_800A4788
lbl_800A4780:
/* 800A4780 000A16C0  3B 80 FF FA */	li r28, -6
/* 800A4784 000A16C4  48 00 00 28 */	b lbl_800A47AC
lbl_800A4788:
/* 800A4788 000A16C8  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 800A478C 000A16CC  3C 60 80 0A */	lis r3, EraseCallback@ha
/* 800A4790 000A16D0  38 A3 47 F8 */	addi r5, r3, EraseCallback@l
/* 800A4794 000A16D4  7C 80 21 D6 */	mullw r4, r0, r4
/* 800A4798 000A16D8  38 7E 00 00 */	addi r3, r30, 0
/* 800A479C 000A16DC  4B FF B2 45 */	bl __CARDEraseSector
/* 800A47A0 000A16E0  7C 7C 1B 78 */	mr r28, r3
lbl_800A47A4:
/* 800A47A4 000A16E4  2C 1C 00 00 */	cmpwi r28, 0
/* 800A47A8 000A16E8  40 80 00 30 */	bge lbl_800A47D8
lbl_800A47AC:
/* 800A47AC 000A16EC  83 BF 00 D0 */	lwz r29, 0xd0(r31)
/* 800A47B0 000A16F0  38 00 00 00 */	li r0, 0
/* 800A47B4 000A16F4  38 7F 00 00 */	addi r3, r31, 0
/* 800A47B8 000A16F8  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 800A47BC 000A16FC  7F 84 E3 78 */	mr r4, r28
/* 800A47C0 000A1700  4B FF B4 8D */	bl __CARDPutControlBlock
/* 800A47C4 000A1704  39 9D 00 00 */	addi r12, r29, 0
/* 800A47C8 000A1708  7D 88 03 A6 */	mtlr r12
/* 800A47CC 000A170C  38 7E 00 00 */	addi r3, r30, 0
/* 800A47D0 000A1710  38 9C 00 00 */	addi r4, r28, 0
/* 800A47D4 000A1714  4E 80 00 21 */	blrl 
lbl_800A47D8:
/* 800A47D8 000A1718  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800A47DC 000A171C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800A47E0 000A1720  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800A47E4 000A1724  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800A47E8 000A1728  83 81 00 10 */	lwz r28, 0x10(r1)
/* 800A47EC 000A172C  38 21 00 20 */	addi r1, r1, 0x20
/* 800A47F0 000A1730  7C 08 03 A6 */	mtlr r0
/* 800A47F4 000A1734  4E 80 00 20 */	blr 

EraseCallback:
/* 800A47F8 000A1738  7C 08 02 A6 */	mflr r0
/* 800A47FC 000A173C  90 01 00 04 */	stw r0, 4(r1)
/* 800A4800 000A1740  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800A4804 000A1744  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800A4808 000A1748  93 C1 00 18 */	stw r30, 0x18(r1)
/* 800A480C 000A174C  93 A1 00 14 */	stw r29, 0x14(r1)
/* 800A4810 000A1750  7C 9D 23 79 */	or. r29, r4, r4
/* 800A4814 000A1754  93 81 00 10 */	stw r28, 0x10(r1)
/* 800A4818 000A1758  3B 83 00 00 */	addi r28, r3, 0
/* 800A481C 000A175C  1C BC 01 10 */	mulli r5, r28, 0x110
/* 800A4820 000A1760  3C 60 80 3F */	lis r3, __CARDBlock@ha
/* 800A4824 000A1764  38 03 BF 60 */	addi r0, r3, __CARDBlock@l
/* 800A4828 000A1768  7F E0 2A 14 */	add r31, r0, r5
/* 800A482C 000A176C  41 80 00 30 */	blt lbl_800A485C
/* 800A4830 000A1770  80 9F 00 C0 */	lwz r4, 0xc0(r31)
/* 800A4834 000A1774  3C 60 80 0A */	lis r3, WriteCallback@ha
/* 800A4838 000A1778  38 E3 46 88 */	addi r7, r3, WriteCallback@l
/* 800A483C 000A177C  80 BF 00 0C */	lwz r5, 0xc(r31)
/* 800A4840 000A1780  A0 04 00 10 */	lhz r0, 0x10(r4)
/* 800A4844 000A1784  80 DF 00 B4 */	lwz r6, 0xb4(r31)
/* 800A4848 000A1788  38 7C 00 00 */	addi r3, r28, 0
/* 800A484C 000A178C  7C 85 01 D6 */	mullw r4, r5, r0
/* 800A4850 000A1790  4B FF CB 15 */	bl __CARDWrite
/* 800A4854 000A1794  7C 7D 1B 79 */	or. r29, r3, r3
/* 800A4858 000A1798  40 80 00 30 */	bge lbl_800A4888
lbl_800A485C:
/* 800A485C 000A179C  83 DF 00 D0 */	lwz r30, 0xd0(r31)
/* 800A4860 000A17A0  38 00 00 00 */	li r0, 0
/* 800A4864 000A17A4  38 7F 00 00 */	addi r3, r31, 0
/* 800A4868 000A17A8  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 800A486C 000A17AC  7F A4 EB 78 */	mr r4, r29
/* 800A4870 000A17B0  4B FF B3 DD */	bl __CARDPutControlBlock
/* 800A4874 000A17B4  39 9E 00 00 */	addi r12, r30, 0
/* 800A4878 000A17B8  7D 88 03 A6 */	mtlr r12
/* 800A487C 000A17BC  38 7C 00 00 */	addi r3, r28, 0
/* 800A4880 000A17C0  38 9D 00 00 */	addi r4, r29, 0
/* 800A4884 000A17C4  4E 80 00 21 */	blrl 
lbl_800A4888:
/* 800A4888 000A17C8  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800A488C 000A17CC  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800A4890 000A17D0  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 800A4894 000A17D4  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 800A4898 000A17D8  83 81 00 10 */	lwz r28, 0x10(r1)
/* 800A489C 000A17DC  38 21 00 20 */	addi r1, r1, 0x20
/* 800A48A0 000A17E0  7C 08 03 A6 */	mtlr r0
/* 800A48A4 000A17E4  4E 80 00 20 */	blr 

.global CARDWriteAsync
CARDWriteAsync:
/* 800A48A8 000A17E8  7C 08 02 A6 */	mflr r0
/* 800A48AC 000A17EC  90 01 00 04 */	stw r0, 4(r1)
/* 800A48B0 000A17F0  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 800A48B4 000A17F4  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 800A48B8 000A17F8  3B 86 00 00 */	addi r28, r6, 0
/* 800A48BC 000A17FC  3B 65 00 00 */	addi r27, r5, 0
/* 800A48C0 000A1800  3B E4 00 00 */	addi r31, r4, 0
/* 800A48C4 000A1804  3B C3 00 00 */	addi r30, r3, 0
/* 800A48C8 000A1808  3B A7 00 00 */	addi r29, r7, 0
/* 800A48CC 000A180C  38 9B 00 00 */	addi r4, r27, 0
/* 800A48D0 000A1810  38 BC 00 00 */	addi r5, r28, 0
/* 800A48D4 000A1814  38 C1 00 1C */	addi r6, r1, 0x1c
/* 800A48D8 000A1818  4B FF F9 39 */	bl __CARDSeek
/* 800A48DC 000A181C  2C 03 00 00 */	cmpwi r3, 0
/* 800A48E0 000A1820  40 80 00 08 */	bge lbl_800A48E8
/* 800A48E4 000A1824  48 00 00 C4 */	b lbl_800A49A8
lbl_800A48E8:
/* 800A48E8 000A1828  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A48EC 000A182C  80 83 00 0C */	lwz r4, 0xc(r3)
/* 800A48F0 000A1830  38 84 FF FF */	addi r4, r4, -1
/* 800A48F4 000A1834  7F 80 20 39 */	and. r0, r28, r4
/* 800A48F8 000A1838  40 82 00 0C */	bne lbl_800A4904
/* 800A48FC 000A183C  7F 60 20 39 */	and. r0, r27, r4
/* 800A4900 000A1840  41 82 00 10 */	beq lbl_800A4910
lbl_800A4904:
/* 800A4904 000A1844  38 80 FF 80 */	li r4, -128
/* 800A4908 000A1848  4B FF B3 45 */	bl __CARDPutControlBlock
/* 800A490C 000A184C  48 00 00 9C */	b lbl_800A49A8
lbl_800A4910:
/* 800A4910 000A1850  4B FF CE 21 */	bl __CARDGetDirBlock
/* 800A4914 000A1854  80 1E 00 04 */	lwz r0, 4(r30)
/* 800A4918 000A1858  54 00 30 32 */	slwi r0, r0, 6
/* 800A491C 000A185C  7C 83 02 14 */	add r4, r3, r0
/* 800A4920 000A1860  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A4924 000A1864  4B FF F2 C1 */	bl __CARDAccess
/* 800A4928 000A1868  7C 64 1B 79 */	or. r4, r3, r3
/* 800A492C 000A186C  40 80 00 10 */	bge lbl_800A493C
/* 800A4930 000A1870  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A4934 000A1874  4B FF B3 19 */	bl __CARDPutControlBlock
/* 800A4938 000A1878  48 00 00 70 */	b lbl_800A49A8
lbl_800A493C:
/* 800A493C 000A187C  38 7F 00 00 */	addi r3, r31, 0
/* 800A4940 000A1880  38 9B 00 00 */	addi r4, r27, 0
/* 800A4944 000A1884  4B FE 96 9D */	bl DCStoreRange
/* 800A4948 000A1888  28 1D 00 00 */	cmplwi r29, 0
/* 800A494C 000A188C  41 82 00 0C */	beq lbl_800A4958
/* 800A4950 000A1890  7F A0 EB 78 */	mr r0, r29
/* 800A4954 000A1894  48 00 00 0C */	b lbl_800A4960
lbl_800A4958:
/* 800A4958 000A1898  3C 60 80 0A */	lis r3, __CARDDefaultApiCallback@ha
/* 800A495C 000A189C  38 03 EC 4C */	addi r0, r3, __CARDDefaultApiCallback@l
lbl_800A4960:
/* 800A4960 000A18A0  80 81 00 1C */	lwz r4, 0x1c(r1)
/* 800A4964 000A18A4  3C 60 80 0A */	lis r3, EraseCallback@ha
/* 800A4968 000A18A8  38 A3 47 F8 */	addi r5, r3, EraseCallback@l
/* 800A496C 000A18AC  90 04 00 D0 */	stw r0, 0xd0(r4)
/* 800A4970 000A18B0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A4974 000A18B4  93 E3 00 B4 */	stw r31, 0xb4(r3)
/* 800A4978 000A18B8  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A497C 000A18BC  A0 1E 00 10 */	lhz r0, 0x10(r30)
/* 800A4980 000A18C0  80 83 00 0C */	lwz r4, 0xc(r3)
/* 800A4984 000A18C4  80 7E 00 00 */	lwz r3, 0(r30)
/* 800A4988 000A18C8  7C 84 01 D6 */	mullw r4, r4, r0
/* 800A498C 000A18CC  4B FF B0 55 */	bl __CARDEraseSector
/* 800A4990 000A18D0  7C 7E 1B 79 */	or. r30, r3, r3
/* 800A4994 000A18D4  40 80 00 10 */	bge lbl_800A49A4
/* 800A4998 000A18D8  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 800A499C 000A18DC  7F C4 F3 78 */	mr r4, r30
/* 800A49A0 000A18E0  4B FF B2 AD */	bl __CARDPutControlBlock
lbl_800A49A4:
/* 800A49A4 000A18E4  7F C3 F3 78 */	mr r3, r30
lbl_800A49A8:
/* 800A49A8 000A18E8  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 800A49AC 000A18EC  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 800A49B0 000A18F0  38 21 00 38 */	addi r1, r1, 0x38
/* 800A49B4 000A18F4  7C 08 03 A6 */	mtlr r0
/* 800A49B8 000A18F8  4E 80 00 20 */	blr 

.global CARDWrite
CARDWrite:
/* 800A49BC 000A18FC  7C 08 02 A6 */	mflr r0
/* 800A49C0 000A1900  3C E0 80 0A */	lis r7, __CARDSyncCallback@ha
/* 800A49C4 000A1904  90 01 00 04 */	stw r0, 4(r1)
/* 800A49C8 000A1908  38 E7 EC 50 */	addi r7, r7, __CARDSyncCallback@l
/* 800A49CC 000A190C  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 800A49D0 000A1910  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 800A49D4 000A1914  3B E3 00 00 */	addi r31, r3, 0
/* 800A49D8 000A1918  4B FF FE D1 */	bl CARDWriteAsync
/* 800A49DC 000A191C  2C 03 00 00 */	cmpwi r3, 0
/* 800A49E0 000A1920  40 80 00 08 */	bge lbl_800A49E8
/* 800A49E4 000A1924  48 00 00 0C */	b lbl_800A49F0
lbl_800A49E8:
/* 800A49E8 000A1928  80 7F 00 00 */	lwz r3, 0(r31)
/* 800A49EC 000A192C  4B FF B4 15 */	bl __CARDSync
lbl_800A49F0:
/* 800A49F0 000A1930  80 01 00 24 */	lwz r0, 0x24(r1)
/* 800A49F4 000A1934  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 800A49F8 000A1938  38 21 00 20 */	addi r1, r1, 0x20
/* 800A49FC 000A193C  7C 08 03 A6 */	mtlr r0
/* 800A4A00 000A1940  4E 80 00 20 */	blr 
